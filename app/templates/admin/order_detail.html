{% extends "admin/base.html" %}

{% block title %}Order {{ order.id }} — NOIRID{% endblock %}

{% block content %}
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-black">Order {{ order.id }}</h1>
      <p class="text-sm text-zinc-400">All fields from the database</p>
    </div>
    <a class="text-sm text-zinc-300 hover:text-white" href="/admin/orders">Back to orders</a>
  </div>

  <div class="mt-6 grid gap-6 lg:grid-cols-2">
    <div class="rounded-xl border border-white/10 p-5">
      <h2 class="text-sm uppercase tracking-wider text-zinc-400">Order fields</h2>
      <dl class="mt-4 space-y-3 text-sm">
        <div>
          <dt class="text-zinc-400">Status</dt>
          <dd class="font-semibold">{{ order.status }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Payment status</dt>
          <dd class="font-semibold">{{ order.payment_status }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Currency</dt>
          <dd class="font-semibold">{{ order.currency }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Subtotal</dt>
          <dd class="font-semibold">{{ order.subtotal }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Total</dt>
          <dd class="font-semibold">{{ order.total }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Customer name</dt>
          <dd class="font-semibold">{{ order.customer_name or "—" }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Customer email</dt>
          <dd class="font-semibold">{{ order.customer_email or "—" }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Customer phone</dt>
          <dd class="font-semibold">{{ order.customer_phone or "—" }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Shipping address</dt>
          <dd class="font-semibold break-words">{{ order.shipping_address or {} }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Created at</dt>
          <dd class="font-semibold">{{ order.created_at }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Updated at</dt>
          <dd class="font-semibold">{{ order.updated_at }}</dd>
        </div>
        <div>
          <dt class="text-zinc-400">Tracking number</dt>
          <dd class="font-semibold">{{ order.tracking_number }}</dd>
        </div>
          <div>
          <dt class="text-zinc-400">Email sent at:</dt>
          <dd class="font-semibold">{{ order.confirmation_email_sent_at }}</dd>
        </div>
          <div>
          <dt class="text-zinc-400">Need post process:</dt>
          <dd class="font-semibold">{{ order.need_post_process }}</dd>
        </div>
      </dl>
    </div>

    <div class="rounded-xl border border-white/10 p-5">
      <h2 class="text-sm uppercase tracking-wider text-zinc-400">Items</h2>
      <div class="mt-4 space-y-3">
        {% for item in order.items %}
          <div class="rounded-lg border border-white/5 p-4 text-sm">
            <div class="font-semibold">{{ item.title_snapshot }}</div>
            <div class="text-zinc-400">Qty: {{ item.qty }} · Price: {{ item.unit_price }}</div>
            <div class="text-zinc-500 text-xs">Product ID: {{ item.product_id }} · Variant ID: {{ item.variant_id or "—" }}</div>
            <div class="text-zinc-500 text-xs">Personalization: {{ item.personalization_json }}</div>
            {% if item.preview_url %}
              <div class="text-zinc-500 text-xs">
                URL:
                <a
                  href="{{ item.preview_url }}"
                  target="_blank"
                  class="text-zinc-300 hover:text-white underline break-all"
                >
                  open preview
                </a>
              </div>
            {% else %}
              <div class="text-zinc-500 text-xs italic text-zinc-600">
                No preview
              </div>
            {% endif %}

          </div>

        {% else %}
          <div class="text-sm text-zinc-400">No items.</div>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="mt-6 rounded-xl border border-white/10 p-5">
    <h2 class="text-sm uppercase tracking-wider text-zinc-400">Payments</h2>
    <div class="mt-4 space-y-3 text-sm">
      {% for payment in payments %}
        <div class="rounded-lg border border-white/5 p-4">
          <div class="grid gap-2 md:grid-cols-2">
            <div>
              <div class="text-zinc-400">ID</div>
              <div class="font-semibold">{{ payment.id }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Order ID</div>
              <div class="font-semibold">{{ payment.order_id }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Provider</div>
              <div class="font-semibold">{{ payment.provider }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Status</div>
              <div class="font-semibold">{{ payment.status }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Amount</div>
              <div class="font-semibold">{{ payment.amount }} {{ payment.currency }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Provider order #</div>
              <div class="font-semibold">{{ payment.provider_order_number or "—" }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Provider invoice ID</div>
              <div class="font-semibold">{{ payment.provider_invoice_id or "—" }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Created at</div>
              <div class="font-semibold">{{ payment.created_at }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Message type</div>
              <div class="font-semibold">{{ payment.provider_message_type or "—" }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Order status</div>
              <div class="font-semibold">{{ payment.provider_order_status or "—" }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Invoice status</div>
              <div class="font-semibold">{{ payment.provider_invoice_status or "—" }}</div>
            </div>
            <div>
              <div class="text-zinc-400">Approve status</div>
              <div class="font-semibold">{{ payment.provider_approve_status or "—" }}</div>
            </div>
          </div>
          <div class="mt-3">
            <div class="text-zinc-400">Raw payload</div>
            <pre class="mt-1 whitespace-pre-wrap text-xs text-zinc-300">{{ payment.raw_payload or {} }}</pre>
          </div>
        </div>
      {% else %}
        <div class="text-sm text-zinc-400">No payments yet.</div>
      {% endfor %}
    </div>
  </div>
{% endblock %}

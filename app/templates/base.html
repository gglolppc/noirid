<!DOCTYPE html>
<html lang="en" class="js-loading">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="NOIRID: Custom black-on-black phone cases. Personal identity in texture." />
  <title>{% block title %}NOIRID{% endblock %}</title>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TG47K1XLQ6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}

    // 1. Устанавливаем запрет по умолчанию
    gtag('consent', 'default', {
      'analytics_storage': 'denied',
      'ad_storage': 'denied'
    });

    gtag('js', new Date());
    gtag('config', 'G-TG47K1XLQ6');
  </script>

  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" as="style">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/fonts.css">
    <link rel="stylesheet" href="/static/css/fonts.css">
  <script src="https://cdn.tailwindcss.com"></script>

<style>
  html, body {
    background-color: #050505 !important;
    margin: 0;
    padding: 0;
  }
  body {
    font-family: 'Inter', sans-serif;
    color: #f4f4f5;
  }
  .reveal {
    opacity: 0;
    filter: blur(8px);
    transform: translateY(30px);
    transition: opacity 1s cubic-bezier(0.16, 1, 0.3, 1),
                transform 1s cubic-bezier(0.16, 1, 0.3, 1),
                filter 1s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .reveal.active {
    opacity: 1;
    filter: blur(0);
    transform: translateY(0);
  }
  .js-loading .reveal { opacity: 0 !important; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* --- СТИЛИ МОБИЛЬНОГО МЕНЮ (ВНЕ ANIMATION) --- */
  #mobile-menu {
    /* Скрываем за правой границей экрана */
    transform: translateX(100%);
    transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  #mobile-menu.open {
    transform: translateX(0);
  }

  /* Ссылки */
  .mobile-link {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  #mobile-menu.open .mobile-link {
    opacity: 1;
    transform: translateY(0);
  }

  /* Каскадная задержка для каждой ссылки */
  #mobile-menu.open .mobile-link:nth-child(1) { transition-delay: 0.1s; }
  #mobile-menu.open .mobile-link:nth-child(2) { transition-delay: 0.2s; }
  #mobile-menu.open .mobile-link:nth-child(3) { transition-delay: 0.3s; }

  /* Кнопка-бургер превращается в X */
  #menu-toggle.open span:nth-child(1) {
    transform: rotate(45deg) translateY(7px);
  }
  #menu-toggle.open span:nth-child(2) {
    transform: rotate(-45deg) translateY(-7px);
    width: 100%;
  }
</style>

  <script>document.documentElement.classList.add('js-loading');</script>
</head>

<body class="antialiased selection:bg-white selection:text-black">
  <div class="pointer-events-none fixed inset-0 z-[100] opacity-[0.08]"
       style="background-image:url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Cfilter id=%22n%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.7%22 numOctaves=%224%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22200%22 height=%22200%22 filter=%22url(%23n)%22/%3E%3C/svg%3E');">
  </div>

  {% block header %}
<header class="fixed top-0 left-0 right-0 z-50 py-5 md:py-6 bg-[#050505]/90 backdrop-blur-xl border-b border-white/5" id="header">
  <div class="mx-auto max-w-7xl px-6 flex items-center justify-between">
    <a href="/" class="text-base md:text-lg lg:text-xl font-black tracking-[0.6em] uppercase text-white hover:text-zinc-200 transition duration-300" aria-label="NOIRID">
      NOIRID
    </a>

    <div class="flex items-center gap-6">
      <a href="/cart" id="cart-link" class="relative flex items-center gap-2 text-zinc-300 hover:text-white transition group">
        <svg class="w-5 h-5 stroke-current" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
        </svg>
        <span id="cart-text" class="hidden sm:inline text-[10px] uppercase tracking-[0.3em] group-hover:text-white">Cart</span>
      </a>

      <button id="menu-toggle" class="md:hidden relative z-50 w-8 h-8 flex flex-col items-end justify-center gap-1.5 focus:outline-none group" aria-label="Toggle Menu">
        <span class="w-full h-px bg-white transition-all duration-300 group-[.open]:rotate-45 group-[.open]:translate-y-[3.5px]"></span>
        <span class="w-2/3 h-px bg-white transition-all duration-300 group-[.open]:-rotate-45 group-[.open]:-translate-y-[3.5px] group-[.open]:w-full"></span>
      </button>
    </div>

    <nav class="hidden md:flex absolute left-1/2 -translate-x-1/2 items-center gap-10 text-[10px] uppercase tracking-[0.35em] font-medium text-zinc-400">
      <a href="/catalog" class="hover:text-white transition">Catalog</a>
      <a href="/delivery" class="hover:text-white transition">Delivery</a>
      <a href="/about" class="hover:text-white transition">Philosophy</a>
    </nav>
  </div>

  <div id="mobile-menu" class="fixed inset-0 h-screen bg-[#050505] z-40 flex flex-col items-center justify-center translate-x-full transition-transform duration-500 ease-[cubic-bezier(0.16,1,0.3,1)]">
    <nav class="flex flex-col gap-12 text-center">
      <a href="/catalog" class="mobile-link text-2xl uppercase tracking-[0.5em] text-white font-light opacity-0 translate-y-4">Catalog</a>
      <a href="/delivery" class="mobile-link text-2xl uppercase tracking-[0.5em] text-white font-light opacity-0 translate-y-4">Delivery</a>
      <a href="/about" class="mobile-link text-2xl uppercase tracking-[0.5em] text-white font-light opacity-0 translate-y-4">Philosophy</a>
    </nav>

    <div class="absolute bottom-12 text-[10px] uppercase tracking-[0.4em] text-zinc-600">
      Noirid · Discreet Identity
    </div>
  </div>
</header>
{% endblock %}

  <main class="pt-24">
    {% block content %}{% endblock %}
  </main>

  {% block footer %}
  <footer class="border-t border-white/10 py-16 md:py-20 bg-[#050505]">
    <div class="mx-auto max-w-7xl px-6 grid grid-cols-1 md:grid-cols-3 gap-12 md:gap-8">

      <!-- Left: Brand + copy -->
      <div class="text-center md:text-left">
        <h3 class="text-xl md:text-2xl font-black uppercase tracking-[0.5em] text-white mb-4">NOIRID</h3>
        <p class="text-xs uppercase tracking-[0.3em] text-zinc-500">
          © {{ current_year }} — Discreet Identity
        </p>
      </div>

      <!-- Center: Trust & Policies -->
      <div class="text-center">
        <div class="flex flex-wrap justify-center gap-6 mb-8 text-zinc-500">
          <a href="/privacy" class="text-xs uppercase tracking-[0.3em] hover:text-zinc-300">Privacy Policy</a>
          <a href="/terms" class="text-xs uppercase tracking-[0.3em] hover:text-zinc-300">Terms</a>
          <a href="/returns" class="text-xs uppercase tracking-[0.3em] hover:text-zinc-300">Returns</a>
          <a href="/support" class="text-xs uppercase tracking-[0.3em] hover:text-zinc-300">Support</a>
          <a href="/check-order" class="text-xs uppercase tracking-[0.3em] hover:text-zinc-300">Check Order</a>
        </div>

        <!-- Payment badges -->
        <div class="flex justify-center gap-6 opacity-70">
          <img src="/static/icons/visa.webp" alt="Visa" class="h-6">
          <img src="/static/icons/mastercard.webp" alt="Mastercard" class="h-6">
          <img src="/static/icons/paypal.webp" alt="PayPal" class="h-6">
        </div>
      </div>

      <!-- Right: Social + Email capture -->
      <div class="text-center md:text-right">
        <div class="flex justify-center md:justify-end gap-6 mb-6">
          <a href="https://instagram.com/noirid" target="_blank" class="text-zinc-400 hover:text-white">
            <img src="/static/icons/instagram.webp" alt="instagram" class="h-6"></a>
            <a href="https://instagram.com/noirid" target="_blank" class="text-zinc-400 hover:text-white">
            <img src="/static/icons/facebook.webp" alt="facebook" class="h-6"></a>
            <a href="https://instagram.com/noirid" target="_blank" class="text-zinc-400 hover:text-white">
            <img src="/static/icons/tiktok.webp" alt="tiktok" class="h-6"></a>
        </div>

        <!-- Email capture -->
        <form id="subscribe-form" class="flex flex-col gap-3 max-w-xs mx-auto md:mx-0 md:ml-auto">
          <input name="email" type="email" required placeholder="Your email" class="bg-zinc-900 border border-zinc-700 rounded-full px-6 py-3 text-sm text-white placeholder-zinc-500 focus:outline-none focus:border-zinc-400 transition">
          <button type="submit" class="bg-white text-black px-8 py-3 rounded-full text-xs uppercase tracking-[0.4em] font-medium hover:bg-zinc-200 transition">
            Get Updates
          </button>
        </form>
          <p id="subscribe-success"
               class="hidden text-sm text-zinc-400 mt-2">
               You're on the list.
            </p>
      </div>
    </div>
  </footer>

  <div id="cookie-bar" class="fixed bottom-0 left-0 w-full z-[10000] hidden border-t border-white/10 bg-[#050505]/90 backdrop-blur-xl">
    <div class="mx-auto max-w-7xl px-6 py-5 flex flex-col md:flex-row items-center justify-between gap-6">

        <div class="flex items-center gap-4">
            <div class="hidden md:block w-2 h-2 rounded-full bg-zinc-600"></div>
            <p class="text-[11px] md:text-xs text-zinc-400 font-light tracking-wide uppercase leading-relaxed">
                By continuing to explore NOIRID, you agree to our
                <a href="/privacy" class="text-white underline underline-offset-4 hover:text-zinc-500 transition">Privacy Policy</a>.
            </p>
        </div>

        <button id="accept-cookies" class="whitespace-nowrap bg-white text-black px-10 py-3 text-[10px] uppercase tracking-[0.4em] font-black hover:bg-zinc-200 active:scale-[0.95] transition-all">
            Accept
        </button>

    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const bar = document.getElementById('cookie-bar');
        const btn = document.getElementById('accept-cookies');

        // Функция для активации Google Analytics
        function grantConsent() {
            if (typeof gtag === 'function') {
                gtag('consent', 'update', {
                    'analytics_storage': 'granted',
                    'ad_storage': 'granted'
                });
            }
        }

        if (!localStorage.getItem('cookies-accepted')) {
            bar.classList.remove('hidden');
            bar.style.transform = 'translateY(100%)';
            setTimeout(() => {
                bar.style.transition = 'transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)';
                bar.style.transform = 'translateY(0)';
            }, 500);
        } else {
            // Если уже принимали ранее — активируем сразу
            grantConsent();
        }

        btn.addEventListener('click', function() {
            localStorage.setItem('cookies-accepted', 'true');

            // Активируем Google Analytics при клике
            grantConsent();

            bar.style.transform = 'translateY(100%)';
            setTimeout(() => {
                bar.classList.add('hidden');
            }, 600);
        });
    });
</script>


  <script src="{{ url_for('static', path='js/public/subscribe.js') }}"></script>
  {% endblock %}



  <script>
    // -----------------------------
    // Header shadow on scroll
    // -----------------------------
    window.addEventListener('scroll', () => {
      const header = document.getElementById('header');
      if (window.scrollY > 50) {
        header.classList.add('shadow-[0_4px_20px_rgba(0,0,0,0.4)]');
      } else {
        header.classList.remove('shadow-[0_4px_20px_rgba(0,0,0,0.4)]');
      }
    });

    // -----------------------------
    // Cart indicator logic
    // -----------------------------
    const CART_STORAGE_KEY = "cart_summary_v1";

    const cartText = document.getElementById("cart-text");


    function updateCartDisplay(summary) {
      if (!summary || !summary.count || summary.count <= 0) {
        cartText.textContent = "Cart";

        return;
      }

      const total = Math.round(Number(summary.total || 0));
      const cur = summary.currency || "EUR";
      cartText.textContent = `${total} € · ${summary.count}`;

    }

    function saveSummaryToSession(summary) {
      try {
        if (!summary || !summary.count || summary.count <= 0) {
          sessionStorage.removeItem(CART_STORAGE_KEY);
          return;
        }
        sessionStorage.setItem(CART_STORAGE_KEY, JSON.stringify(summary));
      } catch {}
    }

    function loadSummaryFromSession() {
      try {
        const raw = sessionStorage.getItem(CART_STORAGE_KEY);
        return raw ? JSON.parse(raw) : null;
      } catch {
        return null;
      }
    }

    // Initial seed from sessionStorage (no flicker)
    (function seedCartIndicator() {
      const cached = loadSummaryFromSession();
      if (cached) {
        updateCartDisplay(cached);
      }
    })();

    // Fetch from server and update
    window.updateCartIndicator = async function () {
      try {
        const res = await fetch("/api/cart/summary", { method: "GET" });
        if (!res.ok) return;

        const data = await res.json();
        const summary = {
          total: data.total,
          currency: data.currency || "EUR",
          count: Number(data.items_count || 0),
        };

        updateCartDisplay(summary);
        saveSummaryToSession(summary);
      } catch (err) {
        // Silent fail - keep cached or default
        console.warn("Cart summary fetch failed:", err);
      }
    };

    // Run initial sync
    window.updateCartIndicator();

    // Listen for cart updates (from add/remove/etc.)
    window.addEventListener("cart:updated", (e) => {
      const cart = e.detail;
      if (!cart) return window.updateCartIndicator();

      const count = (cart.items || []).reduce((s, it) => s + (Number(it.qty) || 0), 0);
      const summary = {
        total: cart.total,
        currency: cart.currency || "EUR",
        count,
      };

      updateCartDisplay(summary);
      saveSummaryToSession(summary);
    });

    // -----------------------------
    // App init (reveal + mobile menu)
    // -----------------------------
    const initApp = () => {
          document.documentElement.classList.remove('js-loading');

          const toggleBtn = document.getElementById('menu-toggle');
          const mobileMenu = document.getElementById('mobile-menu');

          toggleBtn?.addEventListener('click', () => {
            // Переключаем класс .open и на кнопке, и на меню
            toggleBtn.classList.toggle('open');
            mobileMenu.classList.toggle('open');
            // Блокируем скролл основной страницы при открытом меню
            document.body.classList.toggle('overflow-hidden');
          });

          // Закрытие меню при клике на ссылку
          document.querySelectorAll('.mobile-link').forEach(link => {
            link.addEventListener('click', () => {
              toggleBtn.classList.remove('open');
              mobileMenu.classList.remove('open');
              document.body.classList.remove('overflow-hidden');
            });
          });

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('active');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1 });

      document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    };

    Promise.all([
      document.fonts.ready,
      new Promise(resolve => window.addEventListener('load', resolve))
    ]).then(initApp);
  </script>
</body>
</html>
2026-01-23 11:25:33,788 [INFO] root: Logging initialized in Env.DEV mode with level DEBUG
2026-01-23 11:25:33,803 [INFO] uvicorn.error: Started server process [36232]
2026-01-23 11:25:33,804 [INFO] uvicorn.error: Waiting for application startup.
2026-01-23 11:25:33,804 [INFO] uvicorn.error: Application startup complete.
2026-01-23 11:25:33,805 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-23 11:25:37,511 [INFO] uvicorn.access: 127.0.0.1:61227 - "GET /admin HTTP/1.1" 200
2026-01-23 11:25:39,558 [INFO] uvicorn.access: 127.0.0.1:61227 - "GET /admin/payments HTTP/1.1" 200
2026-01-23 11:25:49,747 [INFO] uvicorn.access: 127.0.0.1:61228 - "GET / HTTP/1.1" 200
2026-01-23 11:25:51,604 [INFO] uvicorn.access: 127.0.0.1:61228 - "GET /p/noir-initials-case HTTP/1.1" 200
2026-01-23 11:25:53,041 [INFO] uvicorn.access: 127.0.0.1:61228 - "POST /api/cart/add HTTP/1.1" 200
2026-01-23 11:25:53,073 [INFO] uvicorn.access: 127.0.0.1:61228 - "GET /cart HTTP/1.1" 200
2026-01-23 11:25:53,151 [INFO] uvicorn.access: 127.0.0.1:61228 - "GET /static/js/public/cart.js HTTP/1.1" 200
2026-01-23 11:25:53,592 [INFO] uvicorn.access: 127.0.0.1:61228 - "GET /api/cart HTTP/1.1" 200
2026-01-23 11:25:54,444 [INFO] uvicorn.access: 127.0.0.1:61228 - "GET /checkout HTTP/1.1" 200
2026-01-23 11:25:54,476 [INFO] uvicorn.access: 127.0.0.1:61228 - "GET /static/js/public/checkout.js HTTP/1.1" 200
2026-01-23 11:25:57,968 [INFO] orders: Order status changed | order_id=3a15e9ef-215e-4f3c-aa4d-59ff76aa2511 | from=draft | to=pending_payment
2026-01-23 11:25:57,970 [INFO] uvicorn.access: 127.0.0.1:61228 - "POST /api/checkout/create-order HTTP/1.1" 200
2026-01-23 11:25:57,982 [INFO] payments: Payment created | order_id=3a15e9ef-215e-4f3c-aa4d-59ff76aa2511 | amount=24.00 | provider=2checkout
2026-01-23 11:25:57,985 [INFO] payments: Payment status changed | order_id=3a15e9ef-215e-4f3c-aa4d-59ff76aa2511 | payment_id=8 | from=created | to=redirected
2026-01-23 11:25:57,985 [INFO] uvicorn.access: 127.0.0.1:61228 - "POST /api/payments/2co/start HTTP/1.1" 200
2026-01-23 11:26:15,215 [INFO] uvicorn.access: 127.0.0.1:61231 - "GET /checkout HTTP/1.1" 200
2026-01-23 11:26:17,455 [INFO] uvicorn.access: 127.0.0.1:61231 - "GET / HTTP/1.1" 200
2026-01-23 11:26:18,774 [INFO] uvicorn.access: 127.0.0.1:61231 - "GET /p/noir-plate-case HTTP/1.1" 200
2026-01-23 11:26:19,991 [INFO] uvicorn.access: 127.0.0.1:61231 - "POST /api/cart/add HTTP/1.1" 200
2026-01-23 11:26:20,005 [INFO] uvicorn.access: 127.0.0.1:61231 - "GET /cart HTTP/1.1" 200
2026-01-23 11:26:20,519 [INFO] uvicorn.access: 127.0.0.1:61231 - "GET /api/cart HTTP/1.1" 200
2026-01-23 11:26:21,265 [INFO] uvicorn.access: 127.0.0.1:61231 - "GET /checkout HTTP/1.1" 200
2026-01-23 11:26:21,298 [INFO] uvicorn.access: 127.0.0.1:61231 - "GET /static/js/public/checkout.js HTTP/1.1" 304
2026-01-23 11:26:24,561 [INFO] orders: Order status changed | order_id=6e650ef7-2d0a-4272-adda-66be5217b1b5 | from=draft | to=pending_payment
2026-01-23 11:26:24,564 [INFO] uvicorn.access: 127.0.0.1:61231 - "POST /api/checkout/create-order HTTP/1.1" 200
2026-01-23 11:26:24,574 [INFO] payments: Payment created | order_id=6e650ef7-2d0a-4272-adda-66be5217b1b5 | amount=26.00 | provider=2checkout
2026-01-23 11:26:24,576 [INFO] payments: Payment status changed | order_id=6e650ef7-2d0a-4272-adda-66be5217b1b5 | payment_id=9 | from=created | to=redirected
2026-01-23 11:26:24,576 [INFO] uvicorn.access: 127.0.0.1:61231 - "POST /api/payments/2co/start HTTP/1.1" 200
2026-01-23 11:31:09,794 [INFO] uvicorn.error: Shutting down
2026-01-23 11:31:09,906 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-23 11:31:09,906 [INFO] uvicorn.error: Application shutdown complete.
2026-01-23 11:31:09,906 [INFO] uvicorn.error: Finished server process [36232]
2026-01-23 11:31:11,784 [INFO] root: Logging initialized in Env.DEV mode with level DEBUG
2026-01-23 11:31:11,800 [INFO] uvicorn.error: Started server process [38192]
2026-01-23 11:31:11,800 [INFO] uvicorn.error: Waiting for application startup.
2026-01-23 11:31:11,801 [INFO] uvicorn.error: Application startup complete.
2026-01-23 11:31:11,802 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-23 11:31:52,796 [INFO] uvicorn.error: Shutting down
2026-01-23 11:31:52,905 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-23 11:31:52,906 [INFO] uvicorn.error: Application shutdown complete.
2026-01-23 11:31:52,906 [INFO] uvicorn.error: Finished server process [38192]
2026-01-23 11:32:23,087 [INFO] root: Logging initialized (dev)
2026-01-23 11:32:23,103 [INFO] uvicorn.error: Started server process [35564]
2026-01-23 11:32:23,103 [INFO] uvicorn.error: Waiting for application startup.
2026-01-23 11:32:23,103 [INFO] uvicorn.error: Application startup complete.
2026-01-23 11:32:23,104 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-23 11:32:55,883 [INFO] uvicorn.access: 127.0.0.1:61308 - "GET / HTTP/1.1" 200
2026-01-23 11:32:58,272 [INFO] uvicorn.access: 127.0.0.1:61308 - "GET /p/noir-initials-case HTTP/1.1" 200
2026-01-23 11:33:03,405 [INFO] uvicorn.access: 127.0.0.1:61309 - "POST /api/cart/add HTTP/1.1" 200
2026-01-23 11:33:03,417 [INFO] uvicorn.access: 127.0.0.1:61309 - "GET /cart HTTP/1.1" 200
2026-01-23 11:33:03,949 [INFO] uvicorn.access: 127.0.0.1:61309 - "GET /api/cart HTTP/1.1" 200
2026-01-23 11:33:06,783 [INFO] uvicorn.access: 127.0.0.1:61309 - "GET /checkout HTTP/1.1" 200
2026-01-23 11:33:06,858 [INFO] uvicorn.access: 127.0.0.1:61309 - "GET /static/js/public/checkout.js HTTP/1.1" 304
2026-01-23 11:33:14,227 [INFO] orders: Order status changed | order_id=e2c0ab7e-a9ea-4e1a-88c1-7d7a4dfbf6df | from=draft | to=pending_payment
2026-01-23 11:33:14,229 [INFO] uvicorn.access: 127.0.0.1:61313 - "POST /api/checkout/create-order HTTP/1.1" 200
2026-01-23 11:33:14,239 [INFO] payments: Payment created | order_id=e2c0ab7e-a9ea-4e1a-88c1-7d7a4dfbf6df | amount=24.00 | provider=2checkout
2026-01-23 11:33:14,241 [INFO] payments: Payment status changed | order_id=e2c0ab7e-a9ea-4e1a-88c1-7d7a4dfbf6df | payment_id=10 | from=created | to=redirected
2026-01-23 11:33:14,241 [INFO] uvicorn.access: 127.0.0.1:61313 - "POST /api/payments/2co/start HTTP/1.1" 200
2026-01-23 11:33:38,029 [INFO] uvicorn.error: Shutting down
2026-01-23 11:33:38,141 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-23 11:33:38,141 [INFO] uvicorn.error: Application shutdown complete.
2026-01-23 11:33:38,141 [INFO] uvicorn.error: Finished server process [35564]
2026-01-23 11:33:40,059 [INFO] root: Logging initialized (prod)
2026-01-23 11:33:40,075 [INFO] uvicorn.error: Started server process [33720]
2026-01-23 11:33:40,076 [INFO] uvicorn.error: Waiting for application startup.
2026-01-23 11:33:40,076 [INFO] uvicorn.error: Application startup complete.
2026-01-23 11:33:40,076 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-23 11:33:52,084 [INFO] orders: Order status changed | order_id=f0a89a9a-1f37-46b8-8355-267a3dcfa039 | from=draft | to=pending_payment
2026-01-23 11:33:52,097 [INFO] payments: Payment created | order_id=f0a89a9a-1f37-46b8-8355-267a3dcfa039 | amount=24.00 | provider=2checkout
2026-01-23 11:33:52,099 [INFO] payments: Payment status changed | order_id=f0a89a9a-1f37-46b8-8355-267a3dcfa039 | payment_id=11 | from=created | to=redirected
2026-01-23 11:35:23,276 [INFO] uvicorn.error: Shutting down
2026-01-23 11:35:23,384 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-23 11:35:23,384 [INFO] uvicorn.error: Application shutdown complete.
2026-01-23 11:35:23,384 [INFO] uvicorn.error: Finished server process [33720]
2026-01-23 12:44:52,217 [INFO] root: Logging initialized (prod)
2026-01-23 12:44:52,233 [INFO] uvicorn.error: Started server process [5064]
2026-01-23 12:44:52,233 [INFO] uvicorn.error: Waiting for application startup.
2026-01-23 12:44:52,234 [INFO] uvicorn.error: Application startup complete.
2026-01-23 12:44:52,234 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-23 12:44:53,329 [INFO] uvicorn.error: Shutting down
2026-01-23 12:44:53,439 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-23 12:44:53,440 [INFO] uvicorn.error: Application shutdown complete.
2026-01-23 12:44:53,440 [INFO] uvicorn.error: Finished server process [5064]
2026-01-24 10:42:11,821 [INFO] root: Logging initialized (prod)
2026-01-24 10:42:11,866 [INFO] uvicorn.error: Started server process [28464]
2026-01-24 10:42:11,867 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 10:42:11,867 [INFO] uvicorn.error: Application startup complete.
2026-01-24 10:42:11,868 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 10:42:49,075 [ERROR] uvicorn.error: Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\routers\pages\admin.py", line 268, in admin_product_create
    product.images = images
    ^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 540, in __set__
    self.impl.set(
    ~~~~~~~~~~~~~^
        instance_state(instance), instance_dict(instance), value, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1976, in set
    old = self.get(
        state,
        dict_,
        passive=PASSIVE_ONLY_PERSISTENT ^ (passive & PassiveFlag.NO_RAISE),
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1141, in _emit_lazyload
    result = session.execute(
        stmt, params, execution_options=execution_options
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2366, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2026-01-24 10:43:05,620 [ERROR] uvicorn.error: Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\routers\pages\admin.py", line 268, in admin_product_create
    product.images = images
    ^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 540, in __set__
    self.impl.set(
    ~~~~~~~~~~~~~^
        instance_state(instance), instance_dict(instance), value, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1976, in set
    old = self.get(
        state,
        dict_,
        passive=PASSIVE_ONLY_PERSISTENT ^ (passive & PassiveFlag.NO_RAISE),
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1141, in _emit_lazyload
    result = session.execute(
        stmt, params, execution_options=execution_options
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2366, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2026-01-24 10:47:52,740 [ERROR] uvicorn.error: Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 177, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 268, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 257, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 205, in bind_execute
asyncpg.exceptions.NotNullViolationError: значение NULL в столбце "sort" отношения "product_image_links" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (8, 3, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: значение NULL в столбце "sort" отношения "product_image_links" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (8, 3, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\routers\pages\admin.py", line 338, in admin_product_update
    await session.commit()
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 591, in execute
    self.dependency_processor.process_saves(uow, states)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\dependency.py", line 1195, in process_saves
    self._run_crud(
    ~~~~~~~~~~~~~~^
        uowcommit, secondary_insert, secondary_update, secondary_delete
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\dependency.py", line 1258, in _run_crud
    connection.execute(statement, secondary_insert)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: значение NULL в столбце "sort" отношения "product_image_links" нарушает ограничение NOT NULL
DETAIL:  Ошибочная строка содержит (8, 3, null, null).
[SQL: INSERT INTO product_image_links (product_id, image_id) VALUES ($1::INTEGER, $2::INTEGER)]
[parameters: (8, 3)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2026-01-24 10:48:53,553 [INFO] uvicorn.error: Shutting down
2026-01-24 10:48:53,660 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 10:48:53,661 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 10:48:53,661 [INFO] uvicorn.error: Finished server process [28464]
2026-01-24 10:51:08,146 [INFO] root: Logging initialized (prod)
2026-01-24 10:51:08,180 [INFO] uvicorn.error: Started server process [28396]
2026-01-24 10:51:08,181 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 10:51:08,181 [INFO] uvicorn.error: Application startup complete.
2026-01-24 10:51:08,181 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 10:51:45,624 [ERROR] uvicorn.error: Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\routers\pages\admin.py", line 268, in admin_product_create
    product.images = images
    ^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 540, in __set__
    self.impl.set(
    ~~~~~~~~~~~~~^
        instance_state(instance), instance_dict(instance), value, None
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1976, in set
    old = self.get(
        state,
        dict_,
        passive=PASSIVE_ONLY_PERSISTENT ^ (passive & PassiveFlag.NO_RAISE),
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ~~~~~~~~~~~~~~~~~~~^
        session,
        ^^^^^^^^
    ...<7 lines>...
        execution_options,
        ^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1141, in _emit_lazyload
    result = session.execute(
        stmt, params, execution_options=execution_options
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2366, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
    ...<2 lines>...
    )
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2026-01-24 10:58:43,965 [INFO] uvicorn.error: Shutting down
2026-01-24 10:58:44,072 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 10:58:44,072 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 10:58:44,072 [INFO] uvicorn.error: Finished server process [28396]
2026-01-24 10:59:08,167 [INFO] root: Logging initialized (prod)
2026-01-24 10:59:08,207 [INFO] uvicorn.error: Started server process [25828]
2026-01-24 10:59:08,207 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 10:59:08,208 [INFO] uvicorn.error: Application startup complete.
2026-01-24 10:59:08,208 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 11:00:22,566 [ERROR] uvicorn.error: Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 177, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 268, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 257, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 205, in bind_execute
asyncpg.exceptions.RestrictViolationError: UPDATE или DELETE в таблице "products" нарушает ограничение RESTRICT внешнего ключа "order_items_product_id_fkey" таблицы "order_items"
DETAIL:  На ключ (id)=(3) есть ссылки в таблице "order_items".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.RestrictViolationError'>: UPDATE или DELETE в таблице "products" нарушает ограничение RESTRICT внешнего ключа "order_items_product_id_fkey" таблицы "order_items"
DETAIL:  На ключ (id)=(3) есть ссылки в таблице "order_items".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\routers\pages\admin.py", line 354, in admin_product_delete
    await session.commit()
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 679, in execute
    util.preloaded.orm_persistence.delete_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, True, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 193, in delete_obj
    _emit_delete_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        delete,
        ^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1471, in _emit_delete_statements
    c = connection.execute(
        statement, del_objects, execution_options=execution_options
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.RestrictViolationError'>: UPDATE или DELETE в таблице "products" нарушает ограничение RESTRICT внешнего ключа "order_items_product_id_fkey" таблицы "order_items"
DETAIL:  На ключ (id)=(3) есть ссылки в таблице "order_items".
[SQL: DELETE FROM products WHERE products.id = $1::INTEGER]
[parameters: (3,)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2026-01-24 11:30:31,134 [INFO] uvicorn.error: Shutting down
2026-01-24 11:30:31,243 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 11:30:31,243 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 11:30:31,244 [INFO] uvicorn.error: Finished server process [25828]
2026-01-24 11:36:23,526 [INFO] root: Logging initialized (prod)
2026-01-24 11:36:23,581 [INFO] uvicorn.error: Started server process [17076]
2026-01-24 11:36:23,581 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 11:36:23,582 [INFO] uvicorn.error: Application startup complete.
2026-01-24 11:36:23,582 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 11:37:45,720 [ERROR] uvicorn.error: Exception in ASGI application
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 251, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 153, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/codecs/uuid.pyx", line 16, in asyncpg.pgproto.pgproto.uuid_encode
  File "asyncpg/pgproto/uuid.pyx", line 121, in asyncpg.pgproto.pgproto.pg_uuid_bytes_from_str
ValueError: invalid UUID '3a15e9ef-215e-4f3c-aa4d-59ff76aa253': decodes to less than 16 bytes

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 177, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 268, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 257, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 184, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: '3a15e9ef-215e-4f3c-aa4d-59ff76aa253' (invalid UUID '3a15e9ef-215e-4f3c-aa4d-59ff76aa253': decodes to less than 16 bytes)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: '3a15e9ef-215e-4f3c-aa4d-59ff76aa253' (invalid UUID '3a15e9ef-215e-4f3c-aa4d-59ff76aa253': decodes to less than 16 bytes)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\routers\pages\order_status.py", line 19, in order_status_page
    order = await CheckoutRepo.get_order_any(session, order_id)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\repos\checkout.py", line 24, in get_order_any
    res = await session.execute(stmt)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: '3a15e9ef-215e-4f3c-aa4d-59ff76aa253' (invalid UUID '3a15e9ef-215e-4f3c-aa4d-59ff76aa253': decodes to less than 16 bytes)
[SQL: SELECT orders.id, orders.status, orders.currency, orders.customer_email, orders.customer_name, orders.customer_phone, orders.shipping_address, orders.subtotal, orders.total, orders.created_at, orders.updated_at, orders.payment_status 
FROM orders 
WHERE orders.id = $1::UUID]
[parameters: ('3a15e9ef-215e-4f3c-aa4d-59ff76aa253',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2026-01-24 11:39:53,675 [INFO] uvicorn.error: Shutting down
2026-01-24 11:39:53,784 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 11:39:53,784 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 11:39:53,784 [INFO] uvicorn.error: Finished server process [17076]
2026-01-24 11:44:54,906 [INFO] root: Logging initialized (prod)
2026-01-24 11:44:54,950 [INFO] uvicorn.error: Started server process [38360]
2026-01-24 11:44:54,951 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 11:44:54,951 [INFO] uvicorn.error: Application startup complete.
2026-01-24 11:44:54,952 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 11:48:37,627 [INFO] uvicorn.error: Shutting down
2026-01-24 11:48:37,742 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 11:48:37,743 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 11:48:37,743 [INFO] uvicorn.error: Finished server process [38360]
2026-01-24 11:48:39,594 [INFO] root: Logging initialized (prod)
2026-01-24 11:48:39,630 [INFO] uvicorn.error: Started server process [2880]
2026-01-24 11:48:39,631 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 11:48:39,631 [INFO] uvicorn.error: Application startup complete.
2026-01-24 11:48:39,632 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 13:17:40,403 [INFO] uvicorn.error: Shutting down
2026-01-24 13:17:40,513 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 13:17:40,514 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 13:17:40,514 [INFO] uvicorn.error: Finished server process [2880]
2026-01-24 13:21:30,425 [INFO] root: Logging initialized (prod)
2026-01-24 13:21:30,462 [INFO] uvicorn.error: Started server process [19244]
2026-01-24 13:21:30,462 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 13:21:30,463 [INFO] uvicorn.error: Application startup complete.
2026-01-24 13:21:30,463 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 13:48:40,841 [INFO] uvicorn.error: Shutting down
2026-01-24 13:48:40,947 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 13:48:40,948 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 13:48:40,948 [INFO] uvicorn.error: Finished server process [19244]
2026-01-24 13:53:05,954 [INFO] root: Logging initialized (prod)
2026-01-24 13:53:05,992 [INFO] uvicorn.error: Started server process [35240]
2026-01-24 13:53:05,992 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 13:53:05,993 [INFO] uvicorn.error: Application startup complete.
2026-01-24 13:53:05,993 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 13:55:36,685 [ERROR] uvicorn.error: Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\routers\api\cart.py", line 241, in remove_item
    raise HTTPException(status_code=404, detail="Cart is empty")
fastapi.exceptions.HTTPException: 404: Cart is empty

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 59, in wrapped_app
    response = await handler(conn, exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\main.py", line 64, in not_found_handler
    return templates.TemplateResponse("pages/404.html", {"request": request}, status_code=404)
           ^^^^^^^^^
NameError: name 'templates' is not defined
2026-01-24 13:56:01,039 [ERROR] uvicorn.error: Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\routers\api\cart.py", line 241, in remove_item
    raise HTTPException(status_code=404, detail="Cart is empty")
fastapi.exceptions.HTTPException: 404: Cart is empty

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 59, in wrapped_app
    response = await handler(conn, exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\main.py", line 64, in not_found_handler
    return templates.TemplateResponse("pages/404.html", {"request": request}, status_code=404)
           ^^^^^^^^^
NameError: name 'templates' is not defined
2026-01-24 13:56:15,202 [ERROR] uvicorn.error: Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\routers\api\cart.py", line 241, in remove_item
    raise HTTPException(status_code=404, detail="Cart is empty")
fastapi.exceptions.HTTPException: 404: Cart is empty

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 59, in wrapped_app
    response = await handler(conn, exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\main.py", line 64, in not_found_handler
    return templates.TemplateResponse("pages/404.html", {"request": request}, status_code=404)
           ^^^^^^^^^
NameError: name 'templates' is not defined
2026-01-24 13:56:23,914 [ERROR] uvicorn.error: Exception in ASGI application
Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\routers\api\cart.py", line 241, in remove_item
    raise HTTPException(status_code=404, detail="Cart is empty")
fastapi.exceptions.HTTPException: 404: Cart is empty

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\hkari\PycharmProjects\Noirid\.venv\Lib\site-packages\starlette\_exception_handler.py", line 59, in wrapped_app
    response = await handler(conn, exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\hkari\PycharmProjects\Noirid\app\main.py", line 64, in not_found_handler
    return templates.TemplateResponse("pages/404.html", {"request": request}, status_code=404)
           ^^^^^^^^^
NameError: name 'templates' is not defined
2026-01-24 13:57:11,323 [INFO] uvicorn.error: Shutting down
2026-01-24 13:57:11,433 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 13:57:11,433 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 13:57:11,433 [INFO] uvicorn.error: Finished server process [35240]
2026-01-24 13:57:13,374 [INFO] root: Logging initialized (prod)
2026-01-24 13:57:13,411 [INFO] uvicorn.error: Started server process [13656]
2026-01-24 13:57:13,411 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 13:57:13,411 [INFO] uvicorn.error: Application startup complete.
2026-01-24 13:57:13,412 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 13:58:09,074 [INFO] orders: Order status changed | order_id=a43d5664-6baf-4aeb-be71-4a0c749ea3ae | from=draft | to=pending_payment
2026-01-24 13:58:09,096 [INFO] payments: Payment created | order_id=a43d5664-6baf-4aeb-be71-4a0c749ea3ae | amount=26.99 | provider=2checkout
2026-01-24 13:58:09,098 [INFO] payments: Payment status changed | order_id=a43d5664-6baf-4aeb-be71-4a0c749ea3ae | payment_id=16 | from=created | to=redirected
2026-01-24 14:00:03,736 [INFO] uvicorn.error: Shutting down
2026-01-24 14:00:03,842 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 14:00:03,843 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 14:00:03,843 [INFO] uvicorn.error: Finished server process [13656]
2026-01-24 14:15:31,184 [INFO] root: Logging initialized (prod)
2026-01-24 14:15:31,226 [INFO] uvicorn.error: Started server process [4108]
2026-01-24 14:15:31,226 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 14:15:31,226 [INFO] uvicorn.error: Application startup complete.
2026-01-24 14:15:31,227 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 14:19:55,833 [INFO] uvicorn.error: Shutting down
2026-01-24 14:19:55,941 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 14:19:55,941 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 14:19:55,942 [INFO] uvicorn.error: Finished server process [4108]
2026-01-24 14:20:55,727 [INFO] root: Logging initialized (prod)
2026-01-24 14:20:55,767 [INFO] uvicorn.error: Started server process [18780]
2026-01-24 14:20:55,767 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 14:20:55,767 [INFO] uvicorn.error: Application startup complete.
2026-01-24 14:20:55,768 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 14:22:07,661 [INFO] uvicorn.error: Shutting down
2026-01-24 14:22:07,771 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 14:22:07,772 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 14:22:07,772 [INFO] uvicorn.error: Finished server process [18780]
2026-01-24 14:22:09,666 [INFO] root: Logging initialized (prod)
2026-01-24 14:22:09,702 [INFO] uvicorn.error: Started server process [8252]
2026-01-24 14:22:09,702 [INFO] uvicorn.error: Waiting for application startup.
2026-01-24 14:22:09,703 [INFO] uvicorn.error: Application startup complete.
2026-01-24 14:22:09,703 [INFO] uvicorn.error: Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
2026-01-24 15:55:01,903 [INFO] uvicorn.error: Shutting down
2026-01-24 15:55:02,011 [INFO] uvicorn.error: Waiting for application shutdown.
2026-01-24 15:55:02,012 [INFO] uvicorn.error: Application shutdown complete.
2026-01-24 15:55:02,012 [INFO] uvicorn.error: Finished server process [8252]
